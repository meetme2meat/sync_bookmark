<html> 
  <head>
    <script>
    
    function fetchBookmarks()
     {  var xmlContent = ""
       chrome.bookmarks.getTree(function(bookmarks) { 
       var parentBookmarks = bookmarks[0].children  
      
         for (var i=0;i<parentBookmarks.length;i++) {
          if (typeof(parentBookmarks[i].children) == "undefined") 
            xmlContent += "<title>"+parentBookmarks[i].title+"</title> <url>"+parentBookmarks[i].url+"</url>"
          else 
           xmlContent +="<"+parentBookmarks[i].title +">"+getChildren(parentBookmarks[i])+"</"+parentBookmarks[i].title+">"             
         }
         //var params = xmlContent;
       // console.log(xmlContent);     
       })
      // console.log(xmlContent);
      return xmlContent;
     }
      
    function getChildren(bookmarks) {
       var xmlContent = "" 
      // console.log(bookmarks);
       if (typeof(bookmarks.children) == "undefined") {   
         xmlContent += "<title>"+bookmarks[i].title+"</title> <url>"+bookmarks[i].url+"</url>"
       } 
       else{
         for(var i=0;i < bookmarks.children.length;i++) {
           // console.log(i);
           if (typeof(bookmarks.children[i].children) == "undefined") {
             xmlContent += "<title>"+bookmarks.children[i].title+"</title> <url>"+bookmarks.children[i].url+"</url>"
              
             }
           else {
            // console.log(bookmarks.children[i].title);
             //console.log(bookmarks.children);
             // console.log(bookmarks.children);
            // console.log(xmlContent);
             
             xmlContent += "<"+bookmarks.children[i].title+">"+getChildren(bookmarks.children[i])+"</"+bookmarks.children[i].title+">"
            } 
           
         }
       }  
       return xmlContent;
    } 
     
    </script>
    <script>
    function make_ajax_request(params) {
      console.log("Making Ajax Request");
      http = new XMLHttpRequest();
      http.open("POST","http://10.0.2.16/hello",false);
      http.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
      http.onreadystatechange = when_ready;
      http.send(params);
    }
    
    function when_ready()
     {   
      if (http.readyState == 4 && http.status == 200) 
        {   
          var response = http.responseText ; 
          console.log("Response Received");
          console.log(response) 
        } 
     }
    function syn_bookmark() {
      console.log("Fetching Bookmarks")
      params = fetchBookmarks();
      console.log("Bookmark Fetched");
      make_ajax_request(params)   
    }  
    window.onload = function() { 
     console.log("Onload");
     setInterval("syn_bookmark()",120000);
    }
    </script>
  </head>
</html>


